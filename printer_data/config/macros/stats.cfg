[delayed_gcode TRACK_PRINT_TIME]
initial_duration: 60
gcode:
  {% set printing = printer.print_stats.state == 'printing' %}
  {% set curtime = printer.save_variables.variable.total_print_minutes %}

  {% if printing %}
    SAVE_VARIABLE VARIABLE=total_print_minutes VALUE={curtime + 1}
  {% endif %}

  UPDATE_DELAYED_GCODE ID=TRACK_PRINT_TIME DURATION=60

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing: _BASE_SET_PRINT_STATS_INFO
gcode:
  {% set layer = params.CURRENT_LAYER | default(0) | int %}

  {% set vars = printer["gcode_macro _USER_VARIABLES"] %}
  {% set start_layers = vars.lights_print_start_layers %}

  {% set last_status = printer["gcode_macro _SET_LIGHT_STATUS"].last_status %}

  {% if layer > start_layers and last_status != 'printing' %}
    _SET_LIGHT_STATUS STATUS=printing
  {% endif %}
  
  _BASE_SET_PRINT_STATS_INFO {rawparams}
